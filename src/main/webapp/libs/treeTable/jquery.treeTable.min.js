/*
 * jQuery treeTable Plugin VERSION
 * http://ludo.cubicphuse.nl/jquery-plugins/treeTable/doc/
 *
 * Copyright 2011, Ludo van den Boom
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
(function(a){function e(a){var b=[];while(a=k(a))b[b.length]=a[0];return b}function f(c){return a(c).siblings("tr."+b.childPrefix+c[0].id)}function g(a){var b=parseInt(a[0].style.paddingLeft,10);return isNaN(b)?c:b}function h(c,d){var e=a(c.children("td")[b.treeColumn]);e[0].style.paddingLeft=g(e)+d+"px",f(c).each(function(){h(a(this),d)})}function i(c){if(!c.hasClass("initialized")){c.addClass("initialized");var d=f(c);!c.hasClass("parent")&&d.length>0&&c.addClass("parent");if(c.hasClass("parent")){var e=a(c.children("td")[b.treeColumn]),h=g(e)+b.indent;d.each(function(){a(this).children("td")[b.treeColumn].style.paddingLeft=h+"px"});if(b.expandable){var i='<a href="#" title="'+b.stringExpand+'" style="margin-left: -'+b.indent+"px; padding-left: "+b.indent+'px" class="expander"></a>';b.clickableNodeNames?e.wrapInner(i):e.html(i+e.html()),a(e[0].firstChild).click(function(){return c.toggleBranch(),!1}).mousedown(function(){return!1}),a(e[0].firstChild).keydown(function(a){if(a.keyCode==13)return c.toggleBranch(),!1}),b.clickableNodeNames&&(e[0].style.cursor="pointer",a(e).click(function(a){a.target.className!="expander"&&c.toggleBranch()})),b.persist&&m(c)&&c.addClass("expanded"),!c.hasClass("expanded")&&!c.hasClass("collapsed")&&c.addClass(b.initialState),c.hasClass("expanded")&&c.expand()}}}}function j(b,c){b.insertAfter(c),f(b).reverse().each(function(){j(a(this),b[0])})}function k(c){var d=c[0].className.split(" ");for(var e=0;e<d.length;e++)if(d[e].match(b.childPrefix))return a(c).siblings("#"+d[e].substring(b.childPrefix.length));return null}function l(a){if(a.hasClass("expanded"))try{d.set(a.attr("id"),"1")}catch(b){}else try{d.remove(a.attr("id"))}catch(b){}}function m(a){try{return d.get(a.attr("id"))=="1"}catch(b){return!1}}var b,c,d;a.fn.treeTable=function(e){return b=a.extend({},a.fn.treeTable.defaults,e),b.persist&&(d=new Persist.Store(b.persistStoreName)),this.each(function(){a(this).addClass("treeTable").find("tbody tr").each(function(){if(!a(this).hasClass("initialized")){var d=a(this)[0].className.search(b.childPrefix)==-1;d&&isNaN(c)&&(c=parseInt(a(a(this).children("td")[b.treeColumn]).css("padding-left"),10)),!d&&b.expandable&&b.initialState=="collapsed"&&a(this).addClass("ui-helper-hidden"),(!b.expandable||d)&&i(a(this))}})})},a.fn.treeTable.defaults={childPrefix:"child-of-",clickableNodeNames:!1,expandable:!0,indent:19,initialState:"collapsed",onNodeShow:null,onNodeHide:null,treeColumn:0,persist:!1,persistStoreName:"treeTable",stringExpand:"Expand",stringCollapse:"Collapse"},a.fn.expandAll=function(){a(this).find("tr").each(function(){a(this).expand()})},a.fn.collapseAll=function(){a(this).find("tr").each(function(){a(this).collapse()})},a.fn.collapse=function(){return this.each(function(){a(this).removeClass("expanded").addClass("collapsed"),b.persist&&l(a(this)),f(a(this)).each(function(){a(this).hasClass("collapsed")||a(this).collapse(),a(this).addClass("ui-helper-hidden"),a.isFunction(b.onNodeHide)&&b.onNodeHide.call(this)})})},a.fn.expand=function(){return this.each(function(){a(this).removeClass("collapsed").addClass("expanded"),b.persist&&l(a(this)),f(a(this)).each(function(){i(a(this)),a(this).is(".expanded.parent")&&a(this).expand(),a(this).removeClass("ui-helper-hidden"),a.isFunction(b.onNodeShow)&&b.onNodeShow.call(this)})})},a.fn.reveal=function(){return a(e(a(this)).reverse()).each(function(){i(a(this)),a(this).expand().show()}),this},a.fn.appendBranchTo=function(c){var d=a(this),f=k(d),g=a.map(e(a(c)),function(a){return a.id});return a.inArray(d[0].id,g)==-1&&(!f||c.id!=f[0].id)&&c.id!=d[0].id&&(h(d,e(d).length*b.indent*-1),f&&d.removeClass(b.childPrefix+f[0].id),d.addClass(b.childPrefix+c.id),j(d,c),h(d,e(d).length*b.indent)),this},a.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments)},a.fn.toggleBranch=function(){return a(this).hasClass("collapsed")?a(this).expand():a(this).collapse(),this}})(jQuery);